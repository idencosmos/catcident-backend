{% extends "otp/base.html" %}

{% block title %}이메일 OTP 설정 | Catcident Admin{% endblock %}

{% block header %}이메일 인증 설정{% endblock %}

{% block content %}
    <div class="mb-4">
        <div class="alert alert-info" role="alert">
            <i class="bi bi-info-circle"></i> 등록된 이메일로 인증 코드가 발송되었습니다.
        </div>
        <p class="info-text">이메일로 전송된 6자리 인증 코드를 입력하세요.</p>
    </div>
    
    <form method="post">
        {% csrf_token %}
        <div class="mb-4">
            <label for="token" class="form-label">인증 코드</label>
            <input type="text" name="token" id="token" class="form-control" placeholder="6자리 코드 입력" 
                   required inputmode="numeric" pattern="[0-9]*" maxlength="6" autocomplete="off">
            {% if error %}
                <div class="error-message">{{ error }}</div>
            {% endif %}
        </div>
        
        <div class="d-grid">
            <button type="submit" class="btn btn-primary">인증 확인</button>
        </div>
    </form>
    
    <div class="mt-3 text-center">
        <a href="{% url 'setup_otp' %}" class="text-decoration-none text-secondary small">
            <i class="bi bi-arrow-left"></i> 다른 인증 방법 선택
        </a>
    </div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tokenInput = document.getElementById('token');
    
    // Focus on the input field
    tokenInput.focus();
    
    // Restrict input to numbers only
    tokenInput.addEventListener('input', function() {
        this.value = this.value.replace(/[^0-9]/g, '');
    });
    
    // Add countdown timer (optional)
    let timeLeft = 300; // 5 minutes in seconds
    const timerElement = document.createElement('div');
    timerElement.className = 'text-center mt-3 small text-muted';
    timerElement.innerHTML = '코드 유효시간: <span id="timer">5:00</span>';
    document.querySelector('form').appendChild(timerElement);
    
    const timerSpan = document.getElementById('timer');
    const timer = setInterval(function() {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerSpan.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 0) {
            clearInterval(timer);
            timerSpan.textContent = '만료됨';
        }
    }, 1000);
});
</script>
{% endblock %}